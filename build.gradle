group 'Quake'
version '1.0-SNAPSHOT'

def jarname = "QuakeCraft-1.0"

apply plugin: 'java'

sourceCompatibility = 1.7

def version = 0

def versionPropsFile = file('version.properties')

if (versionPropsFile.canRead()) {
    def Properties versionProps = new Properties()

    versionProps.load(new FileInputStream(versionPropsFile))

    def code = versionProps['VERSION_CODE'].toInteger() + 1

    version = code;

    versionProps['VERSION_CODE']=code.toString()
    versionProps.store(versionPropsFile.newWriter(), null)
} else {
    throw new GradleException("Could not read version.properties!")
}

repositories {
    mavenCentral()

    maven {
        url 'https://hub.spigotmc.org/nexus/content/groups/public/'
    }
}

jar {
    manifest {
        attributes(
                "Manifest-Version": "1.0",
                "Implementation-Title": "QuakeCraft",
                "Implementation-Version": "1.0"
        )
    }

    def lastFile = file("build/libs/" + jarname + "-" + (version - 1) + ".jar")

    if(lastFile.exists()) {
        lastFile.delete();
    }

    jar.archiveName = jarname + "-" + version + ".jar"
}

dependencies {
    compile group: 'org.bukkit', name: 'bukkit', version: '1.8.7-R0.1-SNAPSHOT'

    testCompile group: 'junit', name: 'junit', version: '4.11'
}
